#!/bin/bash
#SBATCH --job-name=code-server
#SBATCH --time=<<time>>
#SBATCH --output=<<job>>/job.log
#SBATCH --mem=<<memory>>
#SBATCH --cpus-per-task=<<cpus>>

PASSWORD=$(openssl rand -base64 20)
PORT=$(python3 -c 'import socket; s=socket.socket(); s.bind(("", 0)); print(s.getsockname()[1]); s.close()')
echo "********************************************************************"
echo "Starting code-server in Slurm"
echo "Password to access VSCode:" $PASSWORD
echo "********************************************************************"
PASSWORD=$PASSWORD code-server --bind-addr 0.0.0.0:$PORT --auth password --disable-telemetry
echo "{\"address\": \"$(hostname)", \"port\": ${PORT}}" > <<job>>/access.json
